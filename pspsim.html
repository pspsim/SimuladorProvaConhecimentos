<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Simulador PSP</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  header { background-color: #003366; color: white; position: relative; height: 140px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-weight: bold; overflow: hidden; }
  header .title { font-size: 2.8rem; letter-spacing: 1px; text-transform: uppercase; z-index: 2; }
  header .subtitle { font-size: 1.05rem; font-style: italic; margin-top: 8px; text-align: center; max-width: 90%; z-index: 2; }
  header .stripes { position: absolute; bottom: -60px; right: -20px; width: 240px; height: 300px; transform-origin: bottom right; transform: rotate(17deg); pointer-events: none; background: linear-gradient(to right, #003366 0%, #003366 30%, white 30%, white 38%, #003366 38%, #003366 48%, white 48%, white 55%, #003366 55%, #003366 65%, white 65%, white 72%, #003366 72%, #003366 100%); }
  h2 { margin-top: 30px; color: #003366; border-bottom: 2px solid #003366; padding-bottom: 5px; }
  .question { margin-bottom: 20px; padding: 10px; background: white; border-radius: 5px; }
  .options label { display: block; margin-bottom: 5px; }
  #timer { font-size: 20px; font-weight: bold; text-align: center; margin: 20px 0; }
  #submit { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
  #result { margin-top: 20px; font-size: 18px; font-weight: bold; text-align: center; }
</style>
</head>
<body>

<header>
  <div class="title">SIMULADOR PSP</div>
  <div class="subtitle">Simulação da Prova de Conhecimentos da Polícia de Segurança Pública</div>
  <div class="stripes"></div>
</header>

<div id="timer">02:00:00</div>
<form id="quizForm"></form>
<button id="submit">Submeter Teste</button>
<div id="result"></div>

<script>
// ===================== ARRAY DE PERGUNTAS =====================
const questionsData = [
  { "id": 1, "topic": "I", "question": "“Uma Polícia <b><u>integral</u></b>, <b><u>humana</u></b>, <b><u>forte</u></b>, <b><u>coesa</u></b> e ao serviço do cidadão.” As palavras sublinhadas são…", "options": ["sinónimas", "antónimas", "adjetivos", "advérbios"], "correct": "adjetivos" },
  { "id": 2, "topic": "I", "question": "“A PSP depende do membro do Governo responsável pela Administração Interna.” Qual é o sujeito da frase?", "options": ["\"A PSP...\"", "\"...pela Administração Interna”\"", "\"…do membro do Governo…\"", "\"…do membro do Governo responsável pela Administração Interna\""], "correct": "\"A PSP...\"", },
  { "id": 3, "topic": "I", "question": "Qual das seguintes frases não tem erros quanto aos acentos gráficos?", "options": ["O policia pára há porta da esquadra", "Na esquadra à diversas valências políciaís", "Há na Polícia oportunidades de carreira", "Todas as hipóteses acima estão erradas"], "correct": "Há na Polícia oportunidades de carreira" },
  { "id": 4, "topic": "II", "question": "Qual das seguintes instituições não é uma força de segurança ou Polícia?", "options": ["Polícia de Segurança Pública", "Guarda Nacional Republicana", "Polícia Judiciária", "Serviço de Informações Estratégicas de Defesa"], "correct": "Serviço de Informações Estratégicas de Defesa" },
  { "id": 5, "topic": "II", "question": "Qual dos seguintes crimes é o mais participado em Portugal, segundo o Relatório Anual de Segurança Interna de 2024?", "options": ["Estacionamento abusivo", "Violência doméstica", "Homicídio", "Condução de veículos automóveis com velocidade excessiva"], "correct": "Violência doméstica" },
  { "id": 6, "topic": "III", "question": "O processo criminal assegura…", "options": ["algumas garantias de defesa, dependendo da capacidade económica dos interessados", "todas as garantias de defesa, incluindo o recurso ao Provedor de Justiça", "todas as garantias de defesa, incluindo o recurso", "todas as garantias, exceto o recurso"], "correct": "todas as garantias de defesa, incluindo o recurso" },
  { "id": 7, "topic": "IV", "question": "A DUDH, concretamente no seu artigo 5.º, proíbe…", "options": ["a prisão com culpa formada e tratamentos cruéis, a todos os portugueses de origem ou por adoção", "a tortura, penas ou tratamentos cruéis, desumanos ou degradantes", "penas ou medidas de coação injustas, díspares ou degradantes", "a prisão sem culpa formada e tratamentos cruéis a todos os portugueses, independentemente da idade"], "correct": "a tortura, penas ou tratamentos cruéis, desumanos ou degradantes" },
  { "id": 8, "topic": "V", "question": "De acordo com a Lei Orgânica, a PSP…", "options": ["é uma força de segurança de natureza militar, constituída por militares organizados num corpo especial de tropas e dotada de autonomia administrativa", "está organizada hierarquicamente em todos os níveis da sua estrutura, estando o pessoal com funções policiais sujeito à hierarquia de comando e o pessoal sem funções policiais sujeito às regras gerais de hierarquia da função pública", "é um corpo superior de polícia criminal, está organizada hierarquicamente na dependência do Ministério da Justiça, é um serviço central da administração direta do Estado e um órgão de polícia criminal de competência genérica", "está organizada hierarquicamente em todos os níveis da sua estrutura, militarizada, sendo um serviço central do Estado sem autonomia administrativa"], "correct": "está organizada hierarquicamente em todos os níveis da sua estrutura, estando o pessoal com funções policiais sujeito à hierarquia de comando e o pessoal sem funções policiais sujeito às regras gerais de hierarquia da função pública" },
  { "id": 9, "topic": "VI", "question": "Nos termos do artigo 24.º do seu Estatuto, os polícias têm direito à dotação inicial do fardamento no momento do ingresso na PSP. Para efeitos...", "options": ["a PSP participa nas despesas com a aquisição de fardamento efetuadas pelos polícias na efetividade de serviço, através da atribuição de uma comparticipação anual no valor de € 600, com a natureza de prestação social, que é assegurada decorridos dois anos sobre a data de ingresso na PSP", "a PSP não participa nas despesas com a aquisição de fardamento efetuadas pelos polícias na efetividade de serviço", "a PSP participa nas despesas com a aquisição de fardamento efetuadas pelos polícias na efetividade de serviço, através da atribuição de uma comparticipação anual no valor de € 600, com a natureza de prestação social, que é assegurada decorridos quatro anos sobre a data de ingresso na PSP", "a PSP participa nas despesas com a aquisição de fardamento efetuadas pelos polícias na efetividade de serviço, através da atribuição de uma comparticipação anual no valor de € 600, com a natureza de prestação social, que é assegurada decorridos quatro anos sobre a data de ingresso na PSP"], "correct": “a PSP participa nas despesas com a aquisição de fardamento efetuadas pelos polícias na efetividade de serviço, através da atribuição de uma comparticipação anual no valor de € 600, com a natureza de prestação social, que é assegurada decorridos dois anos sobre a data de ingresso na PSP” },
  { "id": 10, "topic": "VII", "question": "Qual dos seguintes países pertence à União Europeia?", "options": ["Bélgica", "Ucrânia", "Argélia", "Escócia"], "correct": "Bélgica" }
  // ... adiciona todas as perguntas que tiveres ...
];

// ===================== FUNÇÃO PARA EMBARALHAR =====================
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ===================== CRIAR QUIZ =====================
const quizForm = document.getElementById("quizForm");
const timerDiv = document.getElementById("timer");
const submitBtn = document.getElementById("submit");
const resultDiv = document.getElementById("result");

let testQuestions = [];

// Agrupar perguntas por tópico
const topics = {};
questionsData.forEach(q => {
  if (!topics[q.topic]) topics[q.topic] = [];
  topics[q.topic].push(q);
});

// Criar formulário
Object.keys(topics).forEach(topicKey => {
  const topicQuestions = shuffleArray(topics[topicKey]);

  // Título do tópico
  const h2 = document.createElement("h2");
  h2.textContent = `Tópico ${topicKey}`;
  quizForm.appendChild(h2);

  topicQuestions.forEach((q, idx) => {
    const div = document.createElement("div");
    div.className = "question";
    div.style.marginBottom = "15px";

    const p = document.createElement("p");
    p.innerHTML = `${q.id}. ${q.question}`; // numerar a pergunta
    div.appendChild(p);

    // Embaralhar opções (manter "Todas as anteriores" no fim)
    let opts = [...q.options];
    let todasOption;
    const todasIndex = opts.findIndex(o => o.startsWith("Todas"));
    if (todasIndex !== -1) {
      todasOption = opts.splice(todasIndex, 1)[0];
      opts = shuffleArray(opts);
      opts.push(todasOption);
    } else {
      opts = shuffleArray(opts);
    }

    opts.forEach((opt, i) => {
      const label = document.createElement("label"); // etiqueta clicável
      label.style.display = "block";
      label.style.marginBottom = "4px";

      const letra = document.createElement("span");
      letra.textContent = `O ${String.fromCharCode(65 + i)}) `;

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${q.id}`; // ✅ usar q.id
      input.value = i;
      input.style.marginLeft = "5px";
      input.style.marginRight = "5px";

      label.appendChild(letra);
      label.appendChild(input);

      const texto = document.createElement("span");
      texto.textContent = opt;
      label.appendChild(texto);

      div.appendChild(label);
    });

    quizForm.appendChild(div);

    testQuestions.push({
      inputName: `q${q.id}`,
      correct: q.correct,
      optionsRendered: opts,
      questionDiv: div
    });
  });
});

// ===================== TIMER =====================
let time = 2 * 60 * 60; // 2 horas
let timerInterval;
function startTimer() {
  timerInterval = setInterval(() => {
    const h = String(Math.floor(time / 3600)).padStart(2, '0');
    const m = String(Math.floor((time % 3600) / 60)).padStart(2, '0');
    const s = String(time % 60).padStart(2, '0');
    timerDiv.textContent = `${h}:${m}:${s}`;
    if (time <= 0) {
      clearInterval(timerInterval);
      submitTest();
    }
    time--;
  }, 1000);
}

// ===================== SUBMETER E CORRIGIR =====================
function submitTest() {
  clearInterval(timerInterval);
  let scoreCount = 0;

  testQuestions.forEach(q => {
    // Limpar feedback antigo
    q.questionDiv.querySelectorAll('.feedback').forEach(f => f.remove());
    q.questionDiv.style.border = "2px solid #ccc";

    const feedback = document.createElement("div");
    feedback.className = "feedback";
    feedback.style.marginTop = "8px";
    feedback.style.fontWeight = "bold";

    const selected = document.querySelector(`input[name="${q.inputName}"]:checked`);
if (selected) {
  const userIndex = parseInt(selected.value);
  const userAnswerText = q.optionsRendered[userIndex]; // pega o texto da opção selecionada

  if (userAnswerText === q.correct) { // compara com o texto certo
    scoreCount++;
    q.questionDiv.style.border = "2px solid green";
    feedback.style.color = "green";
    feedback.textContent = "✔ Resposta correta";
  } else {
    q.questionDiv.style.border = "2px solid red";
    feedback.style.color = "red";
    feedback.innerHTML = `
      ✘ Resposta errada<br>
      A tua resposta: O ${String.fromCharCode(65 + userIndex)}) ${userAnswerText}<br>
      Resposta correta: ${q.correct}
    `;
  }
} else {
  q.questionDiv.style.border = "2px solid orange";
  feedback.style.color = "orange";
  feedback.textContent = "⚠ Pergunta não respondida";
}

    q.questionDiv.appendChild(feedback);
  });

  const finalScore = (scoreCount / testQuestions.length) * 20;
  resultDiv.textContent = `Acertaste ${scoreCount}/${testQuestions.length} perguntas. Nota final: ${finalScore.toFixed(2)}/20`;
}

// ===================== EVENTO SUBMIT =====================
submitBtn.addEventListener("click", e => {
  e.preventDefault();
  submitTest();
});

// ===================== INICIAR =====================
startTimer();
</script>
</body>
</html>