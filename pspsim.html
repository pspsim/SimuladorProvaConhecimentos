<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Simulador PSP</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  header { background-color: #003366; color: white; position: relative; height: 140px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-weight: bold; overflow: hidden; }
  header .title { font-size: 2.8rem; letter-spacing: 1px; text-transform: uppercase; z-index: 2; }
  header .subtitle { font-size: 1.05rem; font-style: italic; margin-top: 8px; text-align: center; max-width: 90%; z-index: 2; }
  header .stripes { position: absolute; bottom: -60px; right: -20px; width: 240px; height: 300px; transform-origin: bottom right; transform: rotate(17deg); pointer-events: none; background: linear-gradient(to right, #003366 0%, #003366 30%, white 30%, white 38%, #003366 38%, #003366 48%, white 48%, white 55%, #003366 55%, #003366 65%, white 65%, white 72%, #003366 72%, #003366 100%); }
  h2 { margin-top: 30px; color: #003366; border-bottom: 2px solid #003366; padding-bottom: 5px; }
  .question { margin-bottom: 20px; padding: 10px; background: white; border-radius: 5px; }
  .options label { display: block; margin-bottom: 5px; }
  #timer { font-size: 20px; font-weight: bold; text-align: center; margin: 20px 0; }
  #submit { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
  #result { margin-top: 20px; font-size: 18px; font-weight: bold; text-align: center; }
</style>
</head>
<body>

<header>
  <div class="title">SIMULADOR PSP</div>
  <div class="subtitle">Simulação da Prova de Conhecimentos da Polícia de Segurança Pública</div>
  <div class="stripes"></div>
</header>

<div id="timer">02:00:00</div>
<form id="quizForm"></form>
<button id="submit">Submeter Teste</button>
<div id="result"></div>

<script>
// =================== DADOS ===================
const topicsData = [
  { name: "Tópico 1: Portugal", questions: [
    { q:"Qual é a capital de Portugal?", options:["Porto","Lisboa","Coimbra","Todas as anteriores"], answer:"B" },
    { q:"Qual é o maior rio de Portugal?", options:["Tejo","Douro","Guadiana","Todas as anteriores"], answer:"A" }
  ]},
  { name: "Tópico 2: União Europeia", questions: [
    { q:"Qual é a moeda da UE?", options:["Euro","Libra","Dólar","Todas as anteriores"], answer:"A" },
    { q:"Quem preside à Comissão Europeia?", options:["Ursula von der Leyen","Merkel","Juncker","Todas as anteriores"], answer:"A" }
  ]},
  { name: "Tópico 3: PSP", questions: [
    { q:"A PSP é força de segurança de que país?", options:["Portugal","Espanha","França","Todas as anteriores"], answer:"A" }
  ]},
  { name: "Tópico 4: Legislação", questions: [
    { q:"Idade mínima para entrar na PSP?", options:["18","20","21","Todas as anteriores"], answer:"A" }
  ]},
  { name: "Tópico 5: Cultura Geral", questions: [
    { q:"Ponto mais alto de Portugal?", options:["Serra da Estrela","Pico","Montejunto","Todas as anteriores"], answer:"B" }
  ]},
  { name: "Tópico 6: Direitos", questions: [
    { q:"Direitos humanos incluem?", options:["Liberdade","Vida","Ambos","Todas as anteriores"], answer:"C" }
  ]},
  { name: "Tópico 7: Atualidades", questions: [
    { q:"País com maior PIB per capita?", options:["Luxemburgo","Suíça","Noruega","Todas as anteriores"], answer:"A" }
  ]}
];

// =================== UTIL ===================
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// =================== GERAR TESTE ===================
const quizForm = document.getElementById("quizForm");
const testQuestions = [];

topicsData.forEach((topic,tIdx)=>{
  const h2=document.createElement("h2");
  h2.textContent=topic.name;
  quizForm.appendChild(h2);

  topic.questions.forEach((q,qIdx)=>{
    const div=document.createElement("div");
    div.className="question";

    const p=document.createElement("p");
    p.textContent=q.q;
    div.appendChild(p);

    let opts=[...q.options];
    const todasIndex=opts.findIndex(o=>o.startsWith("Todas"));
    let todas;
    if(todasIndex!==-1){
      todas=opts.splice(todasIndex,1)[0];
      shuffle(opts);
      opts.push(todas);
    } else shuffle(opts);

    opts.forEach((opt,i)=>{
  const wrapper = document.createElement("div");
  wrapper.style.marginBottom = "6px";

  const label = document.createElement("label");
  label.style.cursor = "pointer";

  label.innerHTML = `
    <input type="radio" name="q_${testQuestions.length}" value="${String.fromCharCode(65+i)}">
    <strong>${String.fromCharCode(65+i)})</strong> ${opt}
  `;

  wrapper.appendChild(label);
  div.appendChild(wrapper);
});

    quizForm.appendChild(div);

    // ⭐ AQUI ESTÁ A PARTE CRÍTICA QUE FALTAVA
    testQuestions.push({
      name: `q_${testQuestions.length}`,
      correct: q.answer,
      options: opts,
      div: div
    });
  });
});

// =================== TIMER ===================
let time=2*60*60;
const timerDiv=document.getElementById("timer");
const timer=setInterval(()=>{
  const h=String(Math.floor(time/3600)).padStart(2,'0');
  const m=String(Math.floor((time%3600)/60)).padStart(2,'0');
  const s=String(time%60).padStart(2,'0');
  timerDiv.textContent=`${h}:${m}:${s}`;
  if(time--<=0){clearInterval(timer);submitTest();}
},1000);

// =================== SUBMETER ===================
function submitTest(){
  let correctCount=0;

  testQuestions.forEach(q=>{
    const selected=document.querySelector(`input[name="${q.name}"]:checked`);
    q.div.style.border="2px solid #ccc";

    if(selected){
      if(selected.value===q.correct){
        correctCount++;
        q.div.style.border="2px solid green";
      } else {
        q.div.style.border="2px solid red";
      }
    } else {
      q.div.style.border="2px solid orange";
    }
  });

  const grade=(correctCount/testQuestions.length)*20;
  document.getElementById("result").textContent=
    `Acertaste ${correctCount}/${testQuestions.length} — Nota: ${grade.toFixed(2)}/20`;
}

document.getElementById("submit").onclick=e=>{
  e.preventDefault();
  clearInterval(timer);
  submitTest();
};
</script>
</body>
</html>