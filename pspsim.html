<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Simulador PSP</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  header { background-color: #003366; color: white; position: relative; height: 140px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-weight: bold; overflow: hidden; }
  header .title { font-size: 2.8rem; letter-spacing: 1px; text-transform: uppercase; z-index: 2; }
  header .subtitle { font-size: 1.05rem; font-style: italic; margin-top: 8px; text-align: center; max-width: 90%; z-index: 2; }
  header .stripes { position: absolute; bottom: -60px; right: -20px; width: 240px; height: 300px; transform-origin: bottom right; transform: rotate(17deg); pointer-events: none; background: linear-gradient(to right, #003366 0%, #003366 30%, white 30%, white 38%, #003366 38%, #003366 48%, white 48%, white 55%, #003366 55%, #003366 65%, white 65%, white 72%, #003366 72%, #003366 100%); }
  h2 { margin-top: 30px; color: #003366; border-bottom: 2px solid #003366; padding-bottom: 5px; }
  .question { margin-bottom: 20px; padding: 10px; background: white; border-radius: 5px; }
  .options label { display: block; margin-bottom: 5px; }
  #timer { font-size: 20px; font-weight: bold; text-align: center; margin: 20px 0; }
  #submit { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
  #result { margin-top: 20px; font-size: 18px; font-weight: bold; text-align: center; }
</style>
</head>
<body>

<header>
  <div class="title">SIMULADOR PSP</div>
  <div class="subtitle">Simulação da Prova de Conhecimentos da Polícia de Segurança Pública</div>
  <div class="stripes"></div>
</header>

<div id="timer">02:00:00</div>
<form id="quizForm"></form>
<button id="submit">Submeter Teste</button>
<div id="result"></div>

<script>
// ===================== ARRAY DE PERGUNTAS =====================
const questionsData = [
  { "id": 1, "topic": "I", "question": "“Uma Polícia <b><u>integral</u></b>, <b><u>humana</u></b>, <b><u>forte</u></b>, <b><u>coesa</u></b> e ao serviço do cidadão.” As palavras sublinhadas são…", "options": ["sinónimas", "antónimas", "adjetivos", "advérbios"], "correct": "adjetivos" },
  { "id": 2, "topic": "I", "question": "Qual é a língua oficial de Portugal?", "options": ["Espanhol", "Português", "Francês", "Todas as anteriores"], "correct": 1 },
  { "id": 3, "topic": "I", "question": "O Pico situa-se em que arquipélago?", "options": ["Madeira", "Açores", "Canárias", "Todas as anteriores"], "correct": 1 },
  { "id": 4, "topic": "II", "question": "Quem escreveu 'Os Lusíadas'?", "options": ["Fernando Pessoa", "Luís de Camões", "Eça de Queirós", "Todas as anteriores"], "correct": 1 },
  { "id": 5, "topic": "II", "question": "Qual é o planeta mais próximo do Sol?", "options": ["Vénus", "Mercúrio", "Marte", "Todas as anteriores"], "correct": 1 },
  { "id": 6, "topic": "III", "question": "Quantos Estados-membros tem a União Europeia (2024)?", "options": ["25", "26", "27", "Todas as anteriores"], "correct": 2 },
  { "id": 7, "topic": "IV", "question": "A Constituição da República Portuguesa foi aprovada em:", "options": ["1974", "1975", "1976", "Todas as anteriores"], "correct": 2 },
  { "id": 8, "topic": "V", "question": "A PSP é uma força de segurança de natureza:", "options": ["Militar", "Civil", "Privada", "Todas as anteriores"], "correct": 1 },
  { "id": 9, "topic": "VI", "question": "Os Direitos Humanos são:", "options": ["Universais", "Indivisíveis", "Interdependentes", "Todas as anteriores"], "correct": 3 },
  { "id": 10, "topic": "VII", "question": "Qual é o atual Secretário-Geral da ONU?", "options": ["Ban Ki-moon", "António Guterres", "Jens Stoltenberg", "Todas as anteriores"], "correct": 1 }
  // ... adiciona todas as perguntas que tiveres ...
];

// ===================== FUNÇÃO PARA EMBARALHAR =====================
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ===================== CRIAR QUIZ =====================
const quizForm = document.getElementById("quizForm");
const timerDiv = document.getElementById("timer");
const submitBtn = document.getElementById("submit");
const resultDiv = document.getElementById("result");

let testQuestions = [];

// Agrupar perguntas por tópico
const topics = {};
questionsData.forEach(q => {
  if (!topics[q.topic]) topics[q.topic] = [];
  topics[q.topic].push(q);
});

// Criar formulário
Object.keys(topics).forEach(topicKey => {
  const topicQuestions = shuffleArray(topics[topicKey]);

  // Título do tópico
  const h2 = document.createElement("h2");
  h2.textContent = `Tópico ${topicKey}`;
  quizForm.appendChild(h2);

  topicQuestions.forEach((q, idx) => {
    const div = document.createElement("div");
    div.className = "question";
    div.style.marginBottom = "15px";

    const p = document.createElement("p");
    p.innerHTML = `${q.id}. ${q.question}`; // numerar a pergunta
    div.appendChild(p);

    // Embaralhar opções (manter "Todas as anteriores" no fim)
    let opts = [...q.options];
    let todasOption;
    const todasIndex = opts.findIndex(o => o.startsWith("Todas"));
    if (todasIndex !== -1) {
      todasOption = opts.splice(todasIndex, 1)[0];
      opts = shuffleArray(opts);
      opts.push(todasOption);
    } else {
      opts = shuffleArray(opts);
    }

    opts.forEach((opt, i) => {
      const label = document.createElement("label"); // etiqueta clicável
      label.style.display = "block";
      label.style.marginBottom = "4px";

      const letra = document.createElement("span");
      letra.textContent = `O ${String.fromCharCode(65 + i)}) `;

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${q.id}`; // ✅ usar q.id
      input.value = i;
      input.style.marginLeft = "5px";
      input.style.marginRight = "5px";

      label.appendChild(letra);
      label.appendChild(input);

      const texto = document.createElement("span");
      texto.textContent = opt;
      label.appendChild(texto);

      div.appendChild(label);
    });

    quizForm.appendChild(div);

    testQuestions.push({
      inputName: `q${q.id}`,
      correct: q.correct,
      optionsRendered: opts,
      questionDiv: div
    });
  });
});

// ===================== TIMER =====================
let time = 2 * 60 * 60; // 2 horas
let timerInterval;
function startTimer() {
  timerInterval = setInterval(() => {
    const h = String(Math.floor(time / 3600)).padStart(2, '0');
    const m = String(Math.floor((time % 3600) / 60)).padStart(2, '0');
    const s = String(time % 60).padStart(2, '0');
    timerDiv.textContent = `${h}:${m}:${s}`;
    if (time <= 0) {
      clearInterval(timerInterval);
      submitTest();
    }
    time--;
  }, 1000);
}

// ===================== SUBMETER E CORRIGIR =====================
function submitTest() {
  clearInterval(timerInterval);
  let scoreCount = 0;

  testQuestions.forEach(q => {
    // Limpar feedback antigo
    q.questionDiv.querySelectorAll('.feedback').forEach(f => f.remove());
    q.questionDiv.style.border = "2px solid #ccc";

    const feedback = document.createElement("div");
    feedback.className = "feedback";
    feedback.style.marginTop = "8px";
    feedback.style.fontWeight = "bold";

    const selected = document.querySelector(`input[name="${q.inputName}"]:checked`);
if (selected) {
  const userIndex = parseInt(selected.value);
  const userAnswerText = q.optionsRendered[userIndex]; // pega o texto da opção selecionada

  if (userAnswerText === q.correct) { // compara com o texto certo
    scoreCount++;
    q.questionDiv.style.border = "2px solid green";
    feedback.style.color = "green";
    feedback.textContent = "✔ Resposta correta";
  } else {
    q.questionDiv.style.border = "2px solid red";
    feedback.style.color = "red";
    feedback.innerHTML = `
      ✘ Resposta errada<br>
      A tua resposta: O ${String.fromCharCode(65 + userIndex)}) ${userAnswerText}<br>
      Resposta correta: ${q.correct}
    `;
  }
} else {
  q.questionDiv.style.border = "2px solid orange";
  feedback.style.color = "orange";
  feedback.textContent = "⚠ Pergunta não respondida";
}

    q.questionDiv.appendChild(feedback);
  });

  const finalScore = (scoreCount / testQuestions.length) * 20;
  resultDiv.textContent = `Acertaste ${scoreCount}/${testQuestions.length} perguntas. Nota final: ${finalScore.toFixed(2)}/20`;
}

// ===================== EVENTO SUBMIT =====================
submitBtn.addEventListener("click", e => {
  e.preventDefault();
  submitTest();
});

// ===================== INICIAR =====================
startTimer();
</script>
</body>
</html>